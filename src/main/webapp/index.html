<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script>document.write('<base href="' + document.location + '" />');</script>

    <link rel="icon" href="/app/resources/kandoe-logo-circle-white.png" type="image/x-icon"/>

    <title>Kandoe</title>

    <script src="resources/angular2-polyfills.js"></script>

    <script src="resources/system.src.js"></script>
    <script src="resources/Rx.js"></script>
    <script src="resources/angular2.dev.js"></script>
    <script src="resources/es6-shim.js"></script>
    <script src="resources/jquery-2.2.0.js"></script>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="resources/jsDraw2D.js"></script>
    <script src="resources/router.dev.js"></script>
    <script src="resources/http.dev.js"></script>
    <script src="resources/bootstrap.js"></script>

    <!--Websocket -->
    <script src="//cdn.jsdelivr.net/sockjs/1.0.3/sockjs.min.js"></script>
    <script src="resources/stomp.js"></script>
    <script type="text/javascript">
        var stompClient = null;
        function connect() {
            var socket = new SockJS('/Kandoe/chat'); //local
            //var socket = new SockJS('/chat'); // wildfly
            stompClient = Stomp.over(socket);
            stompClient.connect({}, function (frame) {
                setConnected(true);
                stompClient.subscribe('/topic/chat', function (greeting) {
                    var json = JSON.parse(greeting.body);
                    showGreeting(json.username, json.content);
                });
            });
        }

        function setConnected(connected) {
            document.getElementById('connect').disabled = connected;
            document.getElementById('disconnect').disabled = !connected;
        }

        function disconnect() {
            if (stompClient != null) {
                stompClient.disconnect();
            }
            setConnected(false);
        }

        function sendName() {
            var token = localStorage.getItem("id_token");

            var element = document.getElementById('sendchatmessage');
            var name = element.value;
            stompClient.send("/chat", {}, JSON.stringify({'name': name, 'token': token}));
            element.value = "";
            element.focus();
        }

        function showGreeting(username, message) {
            var response = document.getElementById('receivedMessage');
            var p = document.createElement('p');
            p.style.wordWrap = 'break-word';
            p.appendChild(document.createTextNode(username + ': ' + message));
            response.appendChild(p);
        }

    </script>
    <!-- -->

    <link rel="stylesheet" href="./app/css/bootstrap.css">
    <link rel="stylesheet" href="./app/css/style.css">
    <link rel="stylesheet" href="./app/css/foundation-icons.css">
    <link rel="stylesheet" href="app/css/kandoe-session-card.css">
    <link rel="stylesheet" href="./app/css/organisationList.css">
    <link rel="stylesheet" href="./app/css/rotating-card.css">
    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="./app/css/bootstrap-social.css">

    <!-- 2. Configure SystemJS -->
    <script>
        System.config({
            packages: {
                app: {
                    format: 'register',
                    defaultExtension: 'js'
                }
            }
        });
        System.import('app/boot').then(null, console.error.bind(console));
    </script>

</head>

<!-- 3. Display the application -->
<body>
<script>
    window.fbAsyncInit = function () {
        FB.init({
            appId: '481253435400203',
            xfbml: true,
            version: 'v2.5'
        });
    };

    (function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) {
            return;
        }
        js = d.createElement(s);
        js.id = id;
        js.src = "//connect.facebook.net/en_US/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
</script>
<my-kandoe>Loading home...</my-kandoe>

</body>
<footer class="footer ">

    <div class="footer-container">

        <p class="copy">Â© 2016 Kandoe Inc.</p>

    </div>
</footer>
</html>
